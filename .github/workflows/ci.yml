on: "pull_request"

jobs:
    CI:
        runs-on: ubuntu-20.04
        steps:
        - uses: actions/checkout@v2

        - name: Setup Nodejs
          uses: actions/setup-node@v2
          with:
            node-version: "14.18.0"

        - name: Get yarn cache directory path
          id: yarn-cache-dir-path
          run: echo "::set-output name=dir::$(yarn config get cacheFolder)"

        - name: Cache yarn dependencies
          uses: actions/cache@v2
          id: yarn-cache
          with:
            path: |
              ${{ steps.yarn-cache-dir-path.outputs.dir }}
              **\node_modules
            key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
            restore-keys: |
              ${{ runner.os }}-yarn-

        - name: Install
          if: steps.yarn-cache.outputs.cache-hit != 'true'
          run: yarn install

        - name: Lint
          run: yarn lint

        - name: Test
          run: yarn test --coverage

        - name: Upload coverage to Codecov
          uses: codecov/codecov-action@v2.1.0
          with:
            directory: ./coverage
            verbose: true,
            token: ${{ secrets.CODECOV_TOKEN }}
